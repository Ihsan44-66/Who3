local player = game.Players.LocalPlayer
-- jika teleport akan kembali ke posisi
local originalPosition = nil -- Variabel untuk menyimpan posisi awal

-- Fungsi untuk mendeteksi objek yang bisa diambil (seperti pedang)
local function findDistantSword()
    local targetObject = nil
    local maxDistance = 300 -- Jarak maksimum untuk mendeteksi objek

    for _, obj in pairs(workspace:GetChildren()) do
        if obj:IsA("Tool") and obj:FindFirstChild("Handle") then
            local distance = (player.Character.HumanoidRootPart.Position - obj.Handle.Position).Magnitude
            if distance < maxDistance then
                targetObject = obj
                break -- Langsung keluar setelah menemukan objek pertama dalam jangkauan
            end
        end
    end

    return targetObject
end

-- Fungsi untuk teleportasi lebih cepat
local function teleportToObject()
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
        return -- Pastikan karakter ada dan memiliki HumanoidRootPart
    end

    -- Simpan posisi awal sebelum teleport
    originalPosition = player.Character.HumanoidRootPart.Position

    local targetObject = findDistantSword()
    
    if targetObject then
        -- Ambil posisi dari handle objek, ditambah sedikit tinggi untuk menghindari masalah saat mendarat
        local newPosition = targetObject.Handle.Position + Vector3.new(0, 3, 0)

        -- Teleportasi karakter ke posisi baru
        player.Character:SetPrimaryPartCFrame(CFrame.new(newPosition))

        -- Memberikan umpan balik langsung jika dibutuhkan
        print("Teleporting to sword at: ", newPosition)

        -- Kembali ke posisi asli setelah 0.1 detik
        wait(0.1) -- Tunggu 0.1 detik sebelum kembali
        player.Character:SetPrimaryPartCFrame(CFrame.new(originalPosition))
        print("Returned to original position at: ", originalPosition)

    else
        print("Tidak ada pedang atau objek yang bisa diambil di sekitar.")
    end
end

-- Fungsi untuk membuat GUI Teleport
local function createTeleportButton()
    local existingGui = player.PlayerGui:FindFirstChild("TeleportGui")
    if existingGui then
        existingGui:Destroy() -- Hapus GUI lama jika ada
    end

    -- Membuat ScreenGui untuk tombol teleport
    local screengui = Instance.new("ScreenGui")
    screengui.Name = "TeleportGui"
    screengui.Parent = player:WaitForChild("PlayerGui")

    -- Membuat tombol
    local teleportButton = Instance.new("TextButton")
    teleportButton.Size = UDim2.new(0, 200, 0, 50) -- Ukuran tombol
    teleportButton.Position = UDim2.new(0.8, 0, 0.5, -25) -- Posisi tombol di sebelah kanan layar
    teleportButton.Text = "Teleport to Sword"
    teleportButton.Parent = screengui

    -- Menghubungkan fungsi teleportasi dengan tombol
    teleportButton.MouseButton1Click:Connect(teleportToObject)
end

-- Event saat karakter ditambahkan
player.CharacterAdded:Connect(function()
    wait(0.5) -- Tunggu sejenak agar karakter sepenuhnya dimuat
    createTeleportButton()
end)

-- Membuat GUI saat skrip pertama kali berjalan
createTeleportButton()